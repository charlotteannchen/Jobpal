import{j as e,r as c,E as B,T as o,G as d,B as F}from"./index-BlOkQdXv.js";import{M as W}from"./MainCard-C3pBEfXr.js";import{k as C,l as E,m as P,i as Y,n as _}from"./FirestoreAPI-Cee7iFaQ.js";import{T as v}from"./TextField-BhPecYRS.js";import{B as h}from"./OutlinedInput-BaKqlaj1.js";const M=u=>{if(typeof u!="string")return null;const g=/(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/(?:[^\/\n\s]+\/\S+\/|(?:v|embed|shorts|watch)|\S*?[?&]v=)|youtu\.be\/)([a-zA-Z0-9_-]{11})/,t=u.match(g);return t?t[1]:null},q=({videoId:u})=>e.jsx("div",{style:{width:"100%",height:"0",paddingBottom:"56.25%",position:"relative"},children:e.jsx("iframe",{src:`https://www.youtube.com/embed/${u}`,title:"YouTube video player",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%"}})}),G=({url:u})=>e.jsx("div",{style:{width:"100%",height:"500px",border:"1px solid #ccc"},children:e.jsx("iframe",{src:u,title:"Embedded Page",style:{width:"100%",height:"100%",border:"none"}})}),H=()=>{const[u,g]=c.useState(null),[t,x]=c.useState(null),[r,S]=c.useState(null),[U,k]=c.useState([]),[R,N]=c.useState(!0),[m,f]=c.useState(!1),[D,y]=c.useState(!1),b=B(),a=sessionStorage.getItem("userId"),l=sessionStorage.getItem("skillId"),s=sessionStorage.getItem("LMId");if(!a||!l||!s){console.error("uid, skillId, or LMId is null or undefined:",{userId:a,skillId:l,LMId:s});return}if(c.useEffect(()=>{const n=async()=>{let i={};if(s.toString()==="-1")y(!0),f(!0),i={name:"",URL:"",duration:null,status:1,note:""};else{y(!1),f(!1);try{i=await E(a,l,s),console.log("Fetching learning material details success")}catch(L){g(L.message),console.error("Error fetching learning material details:",L)}}x(i),S(i)},j=async()=>{try{const A=(await Y(a,l)).filter(w=>w.id!==s).map(w=>w.name);k(A)}catch(i){console.error("Error fetching or processing items:",i),k([])}};n(),j()},[a,l,s]),c.useEffect(()=>{t&&r&&N(!1)},[t,r]),R)return e.jsx(o,{variant:"body1",children:"Loading..."});const p=n=>{const{name:j,value:i}=n.target;S({...r,[j]:i})},T=async()=>{if(console.log("Save button clicked!"),I(r.name)){console.error("Name invalid");return}x(r);try{if(D){const n=await _(a,l,r);sessionStorage.setItem("LMId",n.LMId),console.log("Adding new learning material success")}else await C(a,l,s,r),console.log("Updateing learning material success");y(!1),f(!1)}catch(n){console.error("Error saving learning material:",n),g("An error occurred while saving the learning material.")}},I=n=>!n||n.trim()===""?"Learning material name is required":U.some(i=>i===n)?"Learning material name must be unique":"";return e.jsxs(W,{children:[!!(t!=null&&t.URL)&&(M(t.URL)?e.jsx("div",{children:e.jsx(q,{videoId:M(t.URL)})}):e.jsx("div",{children:e.jsx(G,{url:t.URL})})),m?e.jsxs(d,{container:!0,spacing:2,children:[e.jsx(d,{item:!0,xs:12,sm:6,children:e.jsx(v,{fullWidth:!0,multiline:!0,label:"Learning Material Name",name:"name",value:r.name,onChange:p,error:!!I(r.name),helperText:I(r.name)})}),e.jsx(d,{item:!0,xs:12,sm:6,children:e.jsx(v,{fullWidth:!0,multiline:!0,label:"URL",name:"URL",value:r.URL,onChange:p})}),e.jsx(d,{item:!0,xs:12,sm:6,children:e.jsx(v,{fullWidth:!0,multiline:!0,label:"Duration (in mintues)",name:"duration",value:r.duration,onChange:p})})]}):e.jsxs(d,{container:!0,spacing:2,children:[e.jsxs(d,{item:!0,xs:12,sm:6,children:[e.jsx(o,{variant:"subtitle1",children:"Learning Material Name:"}),e.jsx(o,{variant:"body1",children:t.name})]}),e.jsxs(d,{item:!0,xs:12,sm:6,children:[e.jsx(o,{variant:"subtitle1",children:"URL:"}),e.jsx(o,{variant:"body1",children:t.URL})]}),e.jsxs(d,{item:!0,xs:12,sm:6,children:[e.jsx(o,{variant:"subtitle1",children:"Duration:"}),e.jsx(o,{variant:"body1",children:t.duration?`${t.duration} minutes`:"Unknown"})]})]}),e.jsx(o,{variant:"subtitle1",children:"Status:"}),e.jsx(h,{variant:"contained",style:{backgroundColor:t.status===0?"#ffccbc":"#dcedc8"},onClick:async()=>{const n={...t,status:1-t.status};await C(a,l,s,n),x(n)},children:t.status===0?"In progress":"Finished"}),e.jsx(o,{variant:"subtitle1",children:"Notes:"}),e.jsx(o,{component:"dd",variant:"body1",children:e.jsx(v,{fullWidth:!0,multiline:!0,rows:6,name:"note",value:r.note,onChange:p})}),e.jsx(F,{sx:{mt:3,display:"flex",justifyContent:"flex-end"},children:e.jsx(h,{variant:"contained",color:"primary",onClick:T,children:m?"Save all":"Save notes"})}),e.jsx(h,{variant:"contained",color:"primary",onClick:async()=>{b("/skill-detail")},children:"Back"}),e.jsx(h,{variant:m?"outlined":"contained",color:m?"secondary":"primary",onClick:async()=>{m&&s.toString()==="-1"&&b("/skill-detail"),f(!m);const n=await E(a,l,s);x(n)},children:m?"Cancel":"Edit"}),e.jsx(h,{variant:"contained",sx:{backgroundColor:"red",color:"white"},onClick:async()=>{await P(a,l,s)===1?(console.log("Learning material deletion successful"),b("/skill-detail")):console.error("Failed to delete the learning material")},children:"Delete"})]})};export{H as default};
