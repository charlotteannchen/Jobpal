import{P as U,r as c,E as W,j as e,T as r,G as p,B as v,S as F,C as Y}from"./index-DdEOt75r.js";import{M as $}from"./MainCard--5wsFPpG.js";import{a as L,d as z,b as H,g as K,c as B,u as E,e as R,f as Q}from"./FirestoreAPI-D_SwIUHY.js";import{T as x}from"./TextField-DGPohz6k.js";import{B as b}from"./OutlinedInput-CXhGIWp7.js";const _=({skillId:n,label:h,handleDelete:s})=>{const y=W(),C=()=>{sessionStorage.setItem("skillId",n),y("/skill-detail")};return e.jsxs(Y,{sx:{mb:3,boxShadow:1,width:"100%",position:"relative"},children:[e.jsxs(v,{onClick:C,sx:{display:"flex",justifyContent:"center",alignItems:"center",py:4,bgcolor:"primary.light",color:"grey.800",cursor:"pointer",textDecoration:"none"},children:[!h&&e.jsxs(v,{sx:{color:"inherit"},children:["boxShadow: ",shadow]}),h&&e.jsx(v,{sx:{color:"inherit"},children:h})]}),e.jsx(b,{variant:"contained",sx:{backgroundColor:"red",color:"white",position:"absolute",bottom:0,right:0,width:"10%",height:"100%"},onClick:s,children:"Delete"})]})};_.propTypes={label:U.string.isRequired};const se=()=>{const[n,h]=c.useState(null),[s,y]=c.useState(null),[C,D]=c.useState([]),[V,J]=c.useState(null),[j,q]=c.useState([]),[P,G]=c.useState(!0),[d,I]=c.useState(!1),[T,S]=c.useState(!1),[u,O]=c.useState(""),k=W(),o=sessionStorage.getItem("userId"),a=sessionStorage.getItem("jobId");if(!o||!a){console.error("uid or jobId is null or undefined:",{userId:o,jobId:a});return}c.useEffect(()=>{const t=async()=>{let i={};if(a.toString()==="-1")S(!0),I(!0),i={name:"",company:"",description:"",references:"",related_skill:[],events:"",status:"0",note:""};else{S(!1),I(!1);try{i=await L(o,a),console.log("Fetching job details success");const l=await H(o,a);q(l)}catch(l){J(l.message),console.error("Error fetching job details:",l)}}h(i),y(i)},m=async()=>{try{const f=(await K(o)).filter(A=>A.id!==a).map(A=>A.name);D(f)}catch(i){console.error("Error fetching or processing jobs:",i),D([])}};t(),m()},[a,o]),c.useEffect(()=>{(async()=>{if(u)if(u==="-1")sessionStorage.setItem("skillId","-1"),k("/skill-detail");else{console.log(`You selected: ${u}`);const m=[...n.related_skill,u],i={...n,related_skill:m},l=await B(o,u);l.related_job.push({id:u,name:n.name}),E(o,a,i),R(o,u,l),h(i)}})()},[u]);const N=async t=>{console.log("Delete related skill button slicked.");const m=n.related_skill.filter(f=>f!==t),i={...n,related_skill:m},l=await B(o,t);l.related_job.push(u),l.related_job=l.related_job.filter(f=>f.id!==a),E(o,a,i),R(o,u,l),h(i)};if(c.useEffect(()=>{n&&s&&j&&G(!1)},[n,s,j]),P)return e.jsx(r,{variant:"body1",children:"Loading..."});const g=t=>{const{name:m,value:i}=t.target;y({...s,[m]:i})},M=async()=>{if(console.log("Save button clicked!"),w(s.name)){console.error("Name invalid");return}h(s);try{if(T){const t=await Q(o,s);sessionStorage.setItem("jobId",t.jobId),console.log("Adding new job success")}else await E(o,a,s),console.log("Updateing job success");S(!1),I(!1)}catch(t){console.error("Error saving job:",t),J("An error occurred while saving the job.")}},w=t=>!t||t.trim()===""?"Job name is required":C.some(i=>i===t)?"Job name must be unique":"";return e.jsx($,{title:"Job",children:e.jsxs(p,{container:!0,spacing:3,children:[e.jsxs(p,{item:!0,xs:12,sm:6,children:[e.jsxs(v,{component:"dl",sx:{display:"grid",gridTemplateColumns:"auto 1fr",columnGap:2,rowGap:1,alignItems:"center"},children:[e.jsx(r,{component:"dt",variant:"body1",sx:{textAlign:"right"},children:"Name:"}),e.jsx(r,{component:"dd",variant:"body1",children:d?e.jsx(x,{fullWidth:!0,multiline:!0,name:"name",value:s.name,onChange:g,error:!!w(s.name),helperText:w(s.name)}):n.name}),e.jsx(r,{component:"dt",variant:"body1",sx:{textAlign:"right"},children:"Company:"}),e.jsx(r,{component:"dd",variant:"body1",children:d?e.jsx(x,{fullWidth:!0,multiline:!0,name:"company",value:s.company,onChange:g}):n.company}),e.jsx(r,{component:"dt",variant:"body1",sx:{textAlign:"right"},children:"Description:"}),e.jsx(r,{component:"dd",variant:"body1",children:d?e.jsx(x,{fullWidth:!0,multiline:!0,rows:4,name:"description",value:s.description,onChange:g}):n.description}),e.jsx(r,{component:"dt",variant:"body1",sx:{textAlign:"right"},children:"References:"}),e.jsx(r,{component:"dd",variant:"body1",children:d?e.jsx(x,{fullWidth:!0,multiline:!0,rows:4,name:"references",value:s.references,onChange:g}):n.references}),e.jsx(r,{component:"dt",variant:"body1",sx:{textAlign:"right"},children:"Events:"}),e.jsx(r,{component:"dd",variant:"body1",children:d?e.jsx(x,{fullWidth:!0,multiline:!0,rows:4,name:"events",value:s.events,onChange:g}):n.events}),e.jsx(r,{component:"dt",variant:"body1",sx:{textAlign:"right"},children:"Status:"}),e.jsx("div",{children:d?e.jsx("select",{id:"dropdown",name:"status",value:s.status,onChange:g,children:["Listed","Learning","Applied","Interviewing","Finish"].map((t,m)=>e.jsx("option",{value:m,children:t},m))}):["Listed","Learning","Applied","Interviewing","Finish"][n.status]}),e.jsx(r,{component:"dt",variant:"body1",sx:{textAlign:"right",alignSelf:"flex-start"},children:"Notes:"}),e.jsx(r,{component:"dd",variant:"body1",children:e.jsx(x,{fullWidth:!0,multiline:!0,rows:6,name:"note",value:s.note,onChange:g})})]}),e.jsx(v,{sx:{mt:3,display:"flex",justifyContent:"flex-end"},children:e.jsx(b,{variant:"contained",color:"primary",onClick:M,children:d?"Save all":"Save notes"})}),e.jsx(b,{variant:"contained",color:"primary",onClick:async()=>{k("/job-page")},children:"Back"}),e.jsx(b,{variant:d?"outlined":"contained",color:d?"secondary":"primary",onClick:async()=>{d&&a.toString()==="-1"&&k("/job-page"),I(!d);const t=await L(o,a);h(t)},children:d?"Cancel":"Edit"}),e.jsx(b,{variant:"contained",sx:{backgroundColor:"red",color:"white"},onClick:async()=>{await z(o,a)===1?(console.log("Job deletion successful"),k("../job-page")):console.error("Failed to delete the job")},children:"Delete"})]}),e.jsxs(p,{item:!0,xs:12,sm:6,children:[e.jsx(p,{item:!0,children:e.jsx(r,{variant:"h3",children:"Required Skills"})}),!T&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"dropdown",children:"Add other required skills:"}),e.jsxs("select",{id:"dropdown",value:u,onChange:t=>O(t.target.value),children:[e.jsx("option",{value:"",children:"select a skill"}),j.filter(t=>!n.related_skill.includes(t.id)).map(t=>e.jsx("option",{value:t.id,children:t.name},t.id)),e.jsx("option",{value:-1,children:"..Add other skill.."},"add other skill")]})]}),e.jsx(F,{title:"In progress",children:e.jsx(p,{container:!0,spacing:2,children:j.filter(t=>t.status===0&&n.related_skill.includes(t.id)).map(t=>e.jsx(_,{skillId:t.id,label:t.name,handleDelete:()=>N(t.id)},t.id))})}),e.jsx(F,{title:"Finished",children:e.jsx(p,{container:!0,spacing:2,children:j.filter(t=>t.status===1&&n.related_skill.includes(t.id)).map(t=>e.jsx(_,{skillId:t.id,label:t.name,handleDelete:()=>N(t.id)},t.id))})})]})]})})};export{se as default};
