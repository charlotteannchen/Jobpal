import{P as q,r as a,E as L,j as e,T as r,G as x,B as u,F as A,S as M,C as P}from"./index-DdEOt75r.js";import{M as R}from"./MainCard--5wsFPpG.js";import{c as T,h as O,i as J,b as U,j as z,e as H}from"./FirestoreAPI-D_SwIUHY.js";import{T as v}from"./TextField-DGPohz6k.js";import{B as j}from"./OutlinedInput-CXhGIWp7.js";const k=({LMId:o,label:d})=>{const s=L(),h=()=>{sessionStorage.setItem("LMId",o),s("/learning-material")};return e.jsx(P,{sx:{mb:3,boxShadow:1,width:"100%"},children:e.jsxs(u,{onClick:h,sx:{display:"flex",justifyContent:"center",alignItems:"center",py:4,bgcolor:"primary.light",color:"grey.800",cursor:"pointer",textDecoration:"none"},children:[!d&&e.jsxs(u,{sx:{color:"inherit"},children:["boxShadow: ",shadow]}),d&&e.jsx(u,{sx:{color:"inherit"},children:d})]})})};k.propTypes={label:q.string.isRequired};const $=()=>{const[o,d]=a.useState(null),[s,h]=a.useState(null),[N,C]=a.useState([]),[K,w]=a.useState(null),[E,D]=a.useState([]),[_,B]=a.useState(!0),[c,p]=a.useState(!1),[F,y]=a.useState(!1),f=L(),l=sessionStorage.getItem("userId"),n=sessionStorage.getItem("skillId");if(!l||!n){console.error("uid or skillId is null or undefined:",{userId:l,skillId:n});return}if(a.useEffect(()=>{const t=async()=>{let i={};if(n.toString()==="-1")y(!0),p(!0),i={name:"",description:"",related_job:[],n_LM:0,n_finished:0,status:1,note:""};else{y(!1),p(!1);try{i=await T(l,n),console.log("Fetching skill details success");const g=await J(l,n);D(g)}catch(g){w(g.message),console.error("Error fetching skill details:",g)}}d(i),h(i)},m=async()=>{try{const W=(await U(l)).filter(b=>b.id!==n).map(b=>b.name);C(W)}catch(i){console.error("Error fetching or processing skills:",i),C([])}};t(),m()},[n,l]),a.useEffect(()=>{o&&s&&B(!1)},[o,s]),_)return e.jsx(r,{variant:"body1",children:"Loading..."});const S=t=>{const{name:m,value:i}=t.target;h({...s,[m]:i})},G=async()=>{if(console.log("Save button clicked!"),I(s.name)){console.error("Name invalid");return}d(s);try{if(F){const t=await z(l,s);sessionStorage.setItem("skillId",t.skillId),console.log("Adding new skill success")}else await H(l,n,s),console.log("Updateing skill success");y(!1),p(!1)}catch(t){console.error("Error saving skill:",t),w("An error occurred while saving the skill.")}},I=t=>!t||t.trim()===""?"Skill name is required":N.some(i=>i===t)?"Skill name must be unique":"";return e.jsx(R,{title:"Skill",children:e.jsxs(x,{container:!0,spacing:3,children:[e.jsxs(x,{item:!0,xs:12,sm:6,children:[e.jsxs(u,{component:"dl",sx:{display:"grid",gridTemplateColumns:"auto 1fr",columnGap:2,rowGap:1,alignItems:"center"},children:[e.jsx(r,{component:"dt",variant:"body1",sx:{textAlign:"right"},children:"Name:"}),e.jsx(r,{component:"dd",variant:"body1",children:c?e.jsx(v,{fullWidth:!0,multiline:!0,name:"name",value:s.name,onChange:S,error:!!I(s.name),helperText:I(s.name)}):o.name}),e.jsx(r,{component:"dt",variant:"body1",sx:{textAlign:"right"},children:"Description:"}),e.jsx(r,{component:"dd",variant:"body1",children:c?e.jsx(v,{fullWidth:!0,multiline:!0,rows:4,name:"description",value:s.description,onChange:S}):o.description}),e.jsx(r,{component:"dt",variant:"body1",sx:{textAlign:"right"},children:"Related Jobs:"}),e.jsx(r,{component:"dd",variant:"body1",children:e.jsx(u,{sx:{display:"flex",flexWrap:"wrap",gap:1,marginTop:1},children:o.related_job.map((t,m)=>e.jsx(A,{label:t.name,color:"primary",onClick:()=>{sessionStorage.getItem("jobId",t.id),f("/job-detail")}},m))})}),e.jsx(r,{component:"dt",variant:"body1",sx:{textAlign:"right"},children:"Status:"}),e.jsx(r,{component:"dd",variant:"body1",children:e.jsx(A,{label:o.status===0?"In progress":"Finished",sx:{backgroundColor:o.status===0?"#ffccbc":"#dcedc8",color:"#000",marginTop:1}})}),e.jsx(r,{component:"dt",variant:"body1",sx:{textAlign:"right",alignSelf:"flex-start"},children:"Notes:"}),e.jsx(r,{component:"dd",variant:"body1",children:e.jsx(v,{fullWidth:!0,multiline:!0,rows:6,name:"note",value:s.note,onChange:S})})]}),e.jsx(u,{sx:{mt:3,display:"flex",justifyContent:"flex-end"},children:e.jsx(j,{variant:"contained",color:"primary",onClick:G,children:c?"Save all":"Save notes"})}),e.jsx(j,{variant:"contained",color:"primary",onClick:async()=>{f("/skill-page")},children:"Back"}),e.jsx(j,{variant:c?"outlined":"contained",color:c?"secondary":"primary",onClick:async()=>{c&&n.toString()==="-1"&&f("/skill-page"),p(!c);const t=await T(l,n);d(t)},children:c?"Cancel":"Edit"}),e.jsx(j,{variant:"contained",sx:{backgroundColor:"red",color:"white"},onClick:async()=>{await O(l,n)===1?(console.log("Skill deletion successful"),f("../skill-page")):console.error("Failed to delete the skill")},children:"Delete"})]}),e.jsxs(x,{item:!0,xs:12,sm:6,children:[e.jsx(M,{title:"In progress",children:e.jsxs(x,{container:!0,spacing:2,children:[E.filter(t=>t.status===0).map(t=>e.jsx(k,{LMId:t.id,label:t.name},t.id)),!c&&e.jsx(k,{LMId:-1,label:"+"},"add-new")]})}),e.jsx(M,{title:"Finished",children:e.jsx(x,{container:!0,spacing:2,children:E.filter(t=>t.status===1).map(t=>e.jsx(k,{LMId:t.id,label:t.name}))})})]})]})})};export{$ as default};
